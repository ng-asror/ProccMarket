<div class="p-[15px]">
	@if(!topic.isLoading()) {
	<div class="space-y-[20px]">
		@if (topic.value(); as data) {
		@let topic = data.topic;
		<div class="space-y-[15px]">
			<div class="flex text-black/50 text-sm gap-x-[10px]">
				<p class="capitalize text-[16px]">{{topic.created_at | dateFormat:'DD MMM HH:MM'}}</p>
				<div class="flex items-center gap-x-[3px]">
					<lucide-icon [name]="ICONS.Eye" size="20"></lucide-icon>
					<p>{{topic.views_count | numeral: '0a'}}</p>
				</div>
			</div>
			<h1 class="text-2xl font-semibold">{{topic.title}}</h1>
		</div>
		<img [src]="topic.image_url" [alt]="topic.title" class="w-full block h-auto">
		<div [innerHTML]="topic.content"></div>

		<div class="flex items-center gap-x-[20px]">
			<button type="button" class="text-black/50 text-[18px] flex items-center gap-x-[5px] cursor-pointer"
				(click)="topicToggleLike(topic.id, true)">
				<lucide-icon [name]="ICONS.ThumbsUp"
					[color]="topic.user_reaction === 'like'?'#030303':'#00000080'"></lucide-icon>
				<span class="block" [class.text-[#030303]]="topic.user_reaction === 'like'?'#030303':''">{{topic.likes_count |
					numeral:
					'0a'}}</span>
			</button>
			<button type="button" class="text-black/50 text-[18px] flex items-center gap-x-[5px] cursor-pointer"
				(click)="topicToggleLike(topic.id, false)">
				<lucide-icon [name]="ICONS.ThumbsDown"
					[color]="topic.user_reaction === 'dislike'?'#030303':'#00000080'"></lucide-icon>
				<span class="block"
					[class.text-[#030303]]="topic.user_reaction === 'dislike'?'#030303':''">{{topic.dislikes_count |
					numeral: '0a'}}</span>
			</button>
			<button type="button" class="text-black/50 text-[18px] flex items-center gap-x-[5px]">
				<lucide-icon [name]="ICONS.MessagesSquare"></lucide-icon>
				<span class="block">{{topic.posts_count | numeral: '0a'}}</span>
			</button>
		</div>
		<div class="flex items-center justify-between">
			<div class="flex items-center gap-x-[5px] cursor-pointer" (click)="openUserModal(topic.author)">
				<div class="avatar">
					<div class="w-[40px] rounded-full">
						<img
							[src]="topic.author.avatar_url? topic.author.avatar_url: 'https://proccmarket.com/avatars/avatar10.svg'" />
					</div>
				</div>
				<div>
					<h4 class="text-lg font-[400] leading-[100%]">{{topic.author.name??'user' + topic.author.id}}</h4>
					<p class="text-sm text-black/60">{{topic.author.role_name??'Гость'}}</p>
				</div>
			</div>
			<b class="text-black text-[16px]">${{topic.author.balance}}</b>
		</div>
		<div class="space-y-[10px]">
			<h2 class="text-lg font-semibold">Оставьте комментарий</h2>
			<textarea placeholder="Ваш комментарий"
				class="textarea placeholder:text-black/50 textarea-primary mb-[10px] w-full"
				[(ngModel)]="comment().content"></textarea>
			<button type="button" class="btn btn-primary ml-auto block" (click)="createComment()"
				[disabled]="comment().content ===''">Отправить</button>
		</div>
		@if (comments.value(); as comments) {
		<div class="space-y-[10px]">
			@for (item of comments.data; track item.id) {
			<div>
				<app-comment [comment]="item" [commentReplay]="null" [type]="'topic'"></app-comment>
			</div>
			}
		</div>
		}}
	</div>
	<!-- User modal -->
	<input type="checkbox" id="" class="modal-toggle" />
	<dialog class="modal modal-bottom sm:modal-middle" #userModal>
		<div class="modal-box">
			@if (author(); as author) {
			<div class="mb-[-35px]">
				@if(author.cover_url) {
				<img [src]="author.cover_url" [alt]="author.name"
					class="w-full h-[130px] rounded-box object-cover object-center">
				}@else {
				<div class="w-full h-[130px] rounded-box bg-[#F2F2F2]"></div>
				}
			</div>
			<div class="flex items-end gap-x-[10px]">
				<div class="rounded-box w-[90px] h-[90px] border-4 bg-[#ffff] border-[#fff] overflow-hidden">
					@if(author.avatar_url !== null){
					<img src="{{author.avatar_url}}" alt="user face" class="w-full h-full block object-cover object-center">
					}@else {
					<img src="https://proccmarket.com/avatars/avatar10.svg" alt="avatar10"
						class="w-full h-full block rounded-full">
					}
				</div>
				<div class="mb-[10px]">
					<h1 class="text-[20px] text-[#030300] font-[500] mb-1 leading-[100%]">
						{{author.name??'user' + author.id}}</h1>
					<h2 class="text-[16px] lowercase text-[#030300] font-[500] leading-[100%]">
						{{author.role_name? author.role_name: 'Гость'}}</h2>
				</div>
			</div>
			<p class="text-[16px] text-[#030300] leading-[120%] font-[400] block">{{author.description}}</p>
			<button type="button" class="btn btn-primary w-full mt-[10px]" (click)="createChat(author.id)">Написать
				сообщение</button>
			}
			<form method="dialog">
				<button class="btn btn-sm btn-circle absolute right-2 top-2">✕</button>
			</form>
		</div>
	</dialog>
	}@else {
	<div class="flex w-full flex-col gap-4">
		<div class="skeleton h-4 w-full"></div>
		<div class="skeleton h-4 w-[80%]"></div>
		<div class="skeleton h-32 w-full"></div>
		<div class="skeleton h-4 w-full"></div>
		<div class="skeleton h-4 w-full"></div>
		<div class="skeleton h-4 w-full"></div>
		<div class="skeleton h-4 w-full"></div>
		<div class="skeleton h-4 w-full"></div>
		<div class="skeleton h-4 w-full"></div>
		<div class="skeleton h-4 w-full"></div>
		<div class="skeleton h-4 w-full"></div>
		<div class="skeleton h-4 w-full"></div>
		<div class="skeleton h-4 w-full"></div>
		<div class="skeleton h-4 w-full"></div>
		<div class="skeleton h-4 w-full"></div>
		<div class="skeleton h-4 w-full"></div>
		<div class="skeleton h-4 w-full"></div>
		<div class="skeleton h-4 w-full"></div>
		<div class="skeleton h-4 w-full"></div>
		<div class="skeleton h-4 w-full"></div>
		<div class="skeleton h-4 w-full"></div>
	</div>
	}
</div>